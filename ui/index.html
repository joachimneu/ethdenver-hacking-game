<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <script src="./jquery-3.6.0.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="./abi_Resource.js"></script>
        <script src="./abi_Galaxy.js"></script>
        <script src="./contracts.js"></script>
        <script type="module">
            import { ethers } from "./ethers-5.2.esm.min.js";
            

            // A Web3Provider wraps a standard Web3 provider, which is
            // what MetaMask injects as window.ethereum into each page
            const provider = new ethers.providers.Web3Provider(window.ethereum);

            // MetaMask requires requesting permission to connect users accounts
            await provider.send("eth_requestAccounts", []);

            // The MetaMask plugin also allows signing transactions to
            // send ether and pay to change state within the blockchain.
            // For this, you need the account signer...
            const signer = provider.getSigner();


            const UraniumContract = new ethers.Contract(CONTRACT_ADDRESS_URANIUM, ABI_RESOURCE, provider).connect(signer);
            const SpaceshipContract = new ethers.Contract(CONTRACT_ADDRESS_SPACESHIP, ABI_RESOURCE, provider).connect(signer);
            const GalaxyContract = new ethers.Contract(CONTRACT_ADDRESS_GALAXY, ABI_GALAXY, provider).connect(signer);


            // async function setup_galaxy() {
            //     console.log(await UraniumContract.setupGalaxy(CONTRACT_ADDRESS_GALAXY));
            //     console.log(await SpaceshipContract.setupGalaxy(CONTRACT_ADDRESS_GALAXY));
            // }

            // await setup_galaxy();


            async function update_view() {
                $("#display_eth").text(await signer.getBalance() / 1e18);
                $("#display_blockheight").text(await provider.getBlockNumber());
                $("#display_uranium").text(await UraniumContract.balanceOf(await signer.getAddress()));
                $("#display_spaceships").text(await SpaceshipContract.balanceOf(await signer.getAddress()));
            }

            await update_view();

            $(function() {
                $("#button_update_view").on("click", async function() {
                    await update_view();
                    console.log("View updated!");
                });
            });

        </script>
        <!-- ‚è≥ -->
        <!-- üõ°Ô∏è -->
    </head>
    <body>
        <div>
            <div>
                <button id="button_update_view">Update view</button>
            </div>
        </div>
        <div>
            <p>
                <span>üí∏</span>
                <span id="display_eth"></span>
            </p>
            <p>
                <span>‚åö</span>
                <span id="display_blockheight"></span>
            </p>
            <p>
                <span>‚ò¢Ô∏è</span>
                <span id="display_uranium"></span>
            </p>
            <p>
                <span>üöÄ</span>
                <span id="display_spaceships"></span>
            </p>
        </div>
        <div>
            <div>
                <h1>Planets</h1>
                <ol></ol>
            </div>
            <div>
                <h1>Discover</h1>
                <form id="form_discover">
                    <input type="submit" />
                </form>
            </div>
            <div>
                <h1>Mine</h1>
            </div>
            <div>
                <h1>Attack</h1>
            </div>
            <div>
                <h1>Build spaceships</h1>
            </div>
            <div>
                <h1>Build shields</h1>
            </div>
        </div>
    </body>
</html>
